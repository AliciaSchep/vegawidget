---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/vegawidget/vegawidget.svg?branch=master)](https://travis-ci.org/vegawidget/vegawidget)
[![CRAN status](https://www.r-pkg.org/badges/version/vegawidget)](https://cran.r-project.org/package=vegawidget)

# vegawidget

The goal of vegawidget is to render Vega-Lite and Vega specifications into htmlwidgets. For now, this document serves as a manifesto for what we might hope for the package.

Vega and Vega-Lite specifications are just text, formatted as JSON. Let's build a modest Vega-Lite specification using lists:

```{r spec}
spec_mtcars <-
  list(
    `$schema` = "https://vega.github.io/schema/vega-lite/v2.json",
    description = "An mtcars example.",
    data = list(values = mtcars),
    mark = "point",
    encoding = list(
      x = list(field = "wt", type = "quantitative"),
      y = list(field = "mpg", type = "quantitative"),
      color = list(field = "cyl", type = "nominal")
    )
  )  
```

The `vegawidget()` function is used to render specifications into htmlwidgets. If you are reading this document on the GitHub code site, it is further rendered into a PNG: 

```{r vegawidget}
library("vegawidget")

vegawidget(spec_mtcars)
```

If you wish to examine a specification, you may use the `vw_examine()` function, which is a thin wrapper around the `jsonedit()` function from the **listviewer** package.

```{r}
vw_examine(spec_mtcars)
```

If you wish to deploy a specification to be rendered on bl.ocks.org, you can do that too (provied you have a GutHub account).

```{r create_block, eval=FALSE}
# not yet fully implemented
create_block(spec_mtcars)
```

## Installation

You can install vegawidget from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("vegawidget/vegawidget")
```

## Usage

This package provides functions to render Vega and Vega-Lite specifications; it does not help you build specifications. This is left to other packages. Further, this package is designed *not* to be loaded directly; rather its purpose is to make rendering-functions available for such other packages to use.

For example, let's convert `spec_mtcars` to an S3 object with class `"my_class_name"`:

```{r s3}
spec_mtcars_s3 <- structure(
  spec_mtcars,
  class = c("my_class_name")
)

class(spec_mtcars_s3)
```

To take full advantage of these rendering functions, we have to define a method, `as_vegaspec()` for this class, and also define `print()` and `knit_print()` methods.

```{r methods}
as_vegaspec.my_class_name <- function(spec, ...) {
  
  # reverts to list
  spec <- unclass(spec)

  # as_vegaspec has a list method
  vegawidget::as_vegaspec(spec, ...)
}

print.my_class_name <- function(x, ...) {
  
  x <- vegawidget::as_vegaspec(x)
  
  print(x, ...)
}

knit_print.my_class_name <- function(x, ..., options = NULL){
  
  x <- vegawidget::as_vegaspec(x)

  knitr::knit_print(x, ..., options = options)
}
```

With these defined, you can render your specification by printing:

```{r}
spec_mtcars_s3
```

Accordingly, this package offers a templating function, `use_vegawidget(class)` (not yet implemented), to help you integrate vegawidget functions into your package. 

## Future work

In the future, challenges will include:

- offering **crosstalk** compatibility
- offering reactive **shiny** behavior, like **ggvis** provides for its Vega specifications




