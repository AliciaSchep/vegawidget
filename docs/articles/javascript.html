<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extend using JavaScript • vegawidget</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Extend using JavaScript">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vegawidget</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vegaspec.html">Specify using vegaspec</a>
    </li>
    <li>
      <a href="../articles/vegawidget.html">Render using vegawidget</a>
    </li>
    <li>
      <a href="../articles/javascript.html">Extend using JavaScript</a>
    </li>
    <li>
      <a href="../articles/image.html">Create Images</a>
    </li>
    <li>
      <a href="../articles/dates-times.html">Work with Dates and Times</a>
    </li>
    <li>
      <a href="../articles/import.html">Import into Other Packages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vegawidget/vegawidget">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="javascript_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="javascript_files/vega-4.2.0/promise.min.js"></script><script src="javascript_files/vega-4.2.0/symbol.min.js"></script><script src="javascript_files/vega-4.2.0/vega.js"></script><script src="javascript_files/vega-lite-3.0.0/vega-lite.min.js"></script><link href="javascript_files/vega-embed-3.19.2/vega-embed.css" rel="stylesheet">
<script src="javascript_files/vega-embed-3.19.2/vega-embed-modified.js"></script><script src="javascript_files/vegawidget-binding-0.0.4.9000/vegawidget.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Extend using JavaScript</h1>
            
            <h4 class="date">2018-11-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vegawidget/vegawidget/blob/master/vignettes/javascript.Rmd"><code>vignettes/javascript.Rmd</code></a></small>
      <div class="hidden name"><code>javascript.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"vegawidget"</span>)</a></code></pre></div>
<p>The purpose of this article is to show how you can use JavaScript to extend Vega’s capabilities. In these examples, we use the <a href="https://github.com/vega/vega-view">vega-view</a> API to update the dataset using JavaScript. Clearly, this approach is not as intuitive as using Shiny, but it could be useful in situations where Shiny is not available or feasible.</p>
<div id="demo-streaming-data" class="section level2">
<h2 class="hasAnchor">
<a href="#demo-streaming-data" class="anchor"></a>Demo: streaming data</h2>
<p>Here, we recreate this Vega-Lite <a href="https://vega.github.io/vega-lite/tutorials/streaming.html">streaming tutorial</a>. In this case we are using JavaScript both to create the new data, and to update the dataset in Vega.</p>
<p>The point of the original Vega-Lite demo is to show how to use the <a href="https://github.com/vega/vega-view">vega-view</a> API to modify a chart once it has been rendered. The point of this demo is to show the steps you can take to adapt the original Vega-Lite demo to the htmlwidgets context.</p>
<p>Our first step is to create a vegaspec. Note that we have named a dataset to <code>"table"</code>, but we have not included any data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">spec_table &lt;-</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="st">`</span><span class="dt">$schema</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="../reference/vega_schema.html">vega_schema</a></span>(),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="dt">width =</span> <span class="dv">400</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">name =</span> <span class="st">"table"</span>),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="dt">mark =</span> <span class="st">"line"</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="dt">encoding =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">      <span class="dt">x =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">        <span class="dt">field =</span> <span class="st">"x"</span>, </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        <span class="dt">type =</span> <span class="st">"quantitative"</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">        <span class="dt">scale =</span> <span class="kw">list</span>(<span class="dt">zero =</span>  <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">      ),</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">      <span class="dt">y =</span> <span class="kw">list</span>(<span class="dt">field =</span> <span class="st">"y"</span>, <span class="dt">type =</span> <span class="st">"quantitative"</span>),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">      <span class="dt">color =</span> <span class="kw">list</span>(<span class="dt">field =</span> <span class="st">"category"</span>, <span class="dt">type =</span> <span class="st">"nominal"</span>)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">    )</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="../reference/as_vegaspec.html">as_vegaspec</a></span>()</a></code></pre></div>
<p>We use <code><a href="../reference/vegawidget.html">vegawidget()</a></code> function with an <code>elementId</code> argument, to specify the id of the HTML element. This argument is not documented as a part of <code><a href="../reference/vegawidget.html">vegawidget()</a></code>; rather it is passed on to <code>htmlwidget::createWidget()</code> using <code>...</code>. We need to specify this so that the JavaScript code we write later will know which Vega chart to modify.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/vegawidget.html">vegawidget</a></span>(spec_table, <span class="dt">elementId =</span> <span class="st">"streaming-demo"</span>)</a></code></pre></div>
<div id="streaming-demo" style="width:700px;height:432.632880098888px;" class="vegawidget html-widget"></div>
<script type="application/json" data-for="streaming-demo">{"x":{
  "chart_spec": {
    "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
    "width": 400,
    "data": {
      "name": "table"
    },
    "mark": "line",
    "encoding": {
      "x": {
        "field": "x",
        "type": "quantitative",
        "scale": {
          "zero": false
        }
      },
      "y": {
        "field": "y",
        "type": "quantitative"
      },
      "color": {
        "field": "category",
        "type": "nominal"
      }
    }
  },
  "embed_options": {
    "defaultStyle": true,
    "renderer": "canvas"
  }
},"evals":[],"jsHooks":[]}</script><p>In the absence of the code below, we would be left with an empty chart. Note that this is written in JavaScript - in the R Markdown file, this is a <code>{js}</code> chunk, rather than an <code>{r}</code> chunk. We use functionality provided by the <strong>htmlwidgets</strong> package to add a callback function using the <code>HTMLWidgets.addPostRenderHandler()</code> in JavaScript. We could have done the same thing from R using the <code><a href="http://www.rdocumentation.org/packages/htmlwidgets/topics/onStaticRenderComplete">htmlwidgets::onStaticRenderComplete()</a></code> function, where the code inside the callback function would be sent as a R character string. In this case, we preferred to be able to use the JavaScript code highlighting.</p>
<p>The <code>HTMLWidgets.addPostRenderHandler()</code> function is useful because it does not run its code until all the htmlwidgets on the page have been initialized. Without it, our code would fail because it would try to evaluate a Vega view that does not exist when it is run.</p>
<p>We provide a callback function - a function without arguments - the purpose of which is to execute the code inside once all the htmlwidgets have finished rendering. This code is virtually identical to the code in the the Vega-Lite demo; the biggest difference is how we obtain the Vega promise object.</p>
<p>In the demo code, the <code>vegaEmbed()</code> function (described in the <a href="https://github.com/vega/vega-embed">vega-embed</a> library) returns a promise object, a JavaScript object used for asynchronous execution. We do not have direct access to the creation of the promise in the HTML file, but the vegawidget JavaScript API provides a function <code>getVegaPromise()</code> that, given a CSS selector to find the enclosing element (hence the <code>elementId = "table"</code> earlier), returns the promise.</p>
<p>The <code>.then()</code> call contains a function that takes a single argument, <code>result</code> - this is our promise object. A <a href="https://github.com/vega/vega-embed#embed"><code>vegaEmbed()</code></a> promise object contains two objects: a <a href="https://github.com/vega/vega-view#vega-view"><code>view</code></a> instance and a copy of the <code>spec</code> used to create it. Although we are likely interested only in the view, we follow the vega-embed convention to return the entire object so that you refer to the view in the function as <code>result.view</code>.</p>
<p>The rest of the code is copied from the original demonstration. To change a dataset, we use vega-view’s <a href="https://github.com/vega/vega-view#view_change">change</a> method.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">// This is a JavaScript chunk, using {js} instead of {r}</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="va">HTMLWidgets</span>.<span class="at">addPostRenderHandler</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="at">getVegaPromise</span>(<span class="st">'#streaming-demo'</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    .<span class="at">then</span>(<span class="kw">function</span>(result) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">      <span class="co">/**</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">       * Generates a new tuple with random walk.</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">       */</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">      <span class="kw">function</span> <span class="at">newGenerator</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">          <span class="kw">var</span> counter <span class="op">=</span> <span class="dv">-1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">          <span class="kw">var</span> previousY <span class="op">=</span> [<span class="dv">5</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">          <span class="cf">return</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">              counter<span class="op">++;</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">              <span class="kw">var</span> newVals <span class="op">=</span> <span class="va">previousY</span>.<span class="at">map</span>(<span class="kw">function</span> (v<span class="op">,</span> c) <span class="op">{</span> <span class="cf">return</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">                  <span class="dt">x</span><span class="op">:</span> counter<span class="op">,</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">                  <span class="dt">y</span><span class="op">:</span> v <span class="op">+</span> <span class="va">Math</span>.<span class="at">round</span>(<span class="va">Math</span>.<span class="at">random</span>() <span class="op">*</span> <span class="dv">10</span> <span class="op">-</span> c <span class="op">*</span> <span class="dv">3</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">                  <span class="dt">category</span><span class="op">:</span> c</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">              <span class="op">}</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">              previousY <span class="op">=</span> <span class="va">newVals</span>.<span class="at">map</span>(<span class="kw">function</span> (v) <span class="op">{</span> <span class="cf">return</span> <span class="va">v</span>.<span class="at">y</span><span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">              <span class="cf">return</span> newVals<span class="op">;</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">          <span class="op">};</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23">      <span class="op">}</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24">  </a>
<a class="sourceLine" id="cb4-25" data-line-number="25">      <span class="kw">var</span> valueGenerator <span class="op">=</span> <span class="at">newGenerator</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26">      <span class="kw">var</span> minimumX <span class="op">=</span> <span class="dv">-100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27">      <span class="va">window</span>.<span class="at">setInterval</span>(<span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28">          minimumX<span class="op">++;</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">          <span class="kw">var</span> changeSet <span class="op">=</span> <span class="va">vega</span>.<span class="at">changeset</span>()</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">                              .<span class="at">insert</span>(<span class="at">valueGenerator</span>())</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">                              .<span class="at">remove</span>(<span class="kw">function</span> (t) <span class="op">{</span> <span class="cf">return</span> <span class="va">t</span>.<span class="at">x</span> <span class="op">&lt;</span> minimumX<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32">                              </a>
<a class="sourceLine" id="cb4-33" data-line-number="33">          <span class="va">result</span>.<span class="va">view</span>.<span class="at">change</span>(<span class="st">'table'</span><span class="op">,</span> changeSet).<span class="at">run</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34">      <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span>  </a>
<a class="sourceLine" id="cb4-35" data-line-number="35">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<script type="text/javascript">
// This is a JavaScript chunk, using {js} instead of {r}

HTMLWidgets.addPostRenderHandler(function() {

  getVegaPromise('#streaming-demo')
    .then(function(result) {
      /**
       * Generates a new tuple with random walk.
       */
      function newGenerator() {
          var counter = -1;
          var previousY = [5, 5, 5, 5];
          return function () {
              counter++;
              var newVals = previousY.map(function (v, c) { return ({
                  x: counter,
                  y: v + Math.round(Math.random() * 10 - c * 3),
                  category: c
              }); });
              previousY = newVals.map(function (v) { return v.y; });
              return newVals;
          };
      }
  
      var valueGenerator = newGenerator();
      var minimumX = -100;
      window.setInterval(function () {
          minimumX++;
          var changeSet = vega.changeset()
                              .insert(valueGenerator())
                              .remove(function (t) { return t.x < minimumX; });
                              
          result.view.change('table', changeSet).run();
      }, 1000);  
    });

});
</script>
</div>
<div id="demo-externally-driven-data" class="section level2">
<h2 class="hasAnchor">
<a href="#demo-externally-driven-data" class="anchor"></a>Demo: externally-driven data</h2>
<p>This is an adaptation of an <a href="https://beta.observablehq.com/@ijlyttle/using-changesets-with-vega-lite">Observable notebook</a>. The goal here is to show how you can update the data using an external source, like an input. Although we can do this using JavaScript only, the process is not nearly as straightforward as using Shiny. However, this may be useful in cases where it is not feasible to use Shiny.</p>
<p>We will use the <strong>htmltools</strong> package to generate our HTML elements.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"htmltools"</span>)</a></code></pre></div>
<p>We create a range input that we use to specify an angle - in our case 0 to 360 degrees. Our input is named <code>"angle"</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">input_angle &lt;-<span class="st"> </span>tags<span class="op">$</span><span class="kw">input</span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">type =</span> <span class="st">"range"</span>, </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">name =</span> <span class="st">"angle"</span>, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">value =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">min =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="dt">max =</span> <span class="dv">360</span>, </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="dt">step =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  <span class="dt">style =</span> <span class="st">"width: 400px; margin-bottom: 10px;"</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">)</a></code></pre></div>
<p>We then create our vegaspec and our vegawidget output, using a named dataset called <code>"source"</code>. Our chart will be inside an element called <code>"circle"</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">spec_circle &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    <span class="st">`</span><span class="dt">$schema</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="../reference/vega_schema.html">vega_schema</a></span>(),</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="dt">width =</span> <span class="dv">300</span>,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="dt">height =</span> <span class="dv">300</span>,</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="dt">data =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">      <span class="dt">values =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">      <span class="dt">name =</span> <span class="st">"source"</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="dt">mark =</span> <span class="st">"point"</span>,</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="dt">encoding =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">      <span class="dt">x =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">        <span class="dt">field =</span> <span class="st">"x"</span>, </a>
<a class="sourceLine" id="cb7-14" data-line-number="14">        <span class="dt">type =</span> <span class="st">"quantitative"</span>, </a>
<a class="sourceLine" id="cb7-15" data-line-number="15">        <span class="dt">scale =</span> <span class="kw">list</span>(<span class="dt">domain =</span> <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">      ),</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">      <span class="dt">y =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">        <span class="dt">field =</span> <span class="st">"y"</span>, </a>
<a class="sourceLine" id="cb7-19" data-line-number="19">        <span class="dt">type =</span> <span class="st">"quantitative"</span>, </a>
<a class="sourceLine" id="cb7-20" data-line-number="20">        <span class="dt">scale =</span> <span class="kw">list</span>(<span class="dt">domain =</span> <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">      )     </a>
<a class="sourceLine" id="cb7-22" data-line-number="22">    )</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="st">  </span><span class="kw"><a href="../reference/as_vegaspec.html">as_vegaspec</a></span>()</a>
<a class="sourceLine" id="cb7-25" data-line-number="25"></a>
<a class="sourceLine" id="cb7-26" data-line-number="26">output_chart &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vegawidget.html">vegawidget</a></span>(spec_circle, <span class="dt">elementId =</span> <span class="st">"circle"</span>)</a></code></pre></div>
<p>Finally, we create a text output just so that we can see our data object - its id is <code>"text"</code>. Note that we put in some dummy text that will be written-over later.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">output_text &lt;-<span class="st"> </span>tags<span class="op">$</span><span class="kw"><a href="http://www.rdocumentation.org/packages/htmltools/topics/builder">div</a></span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="dt">id =</span> <span class="st">"text"</span>, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">style =</span> <span class="st">"font-family: monospace; margin-bottom: 10px;"</span>,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="st">"Look here for live data"</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">)</a></code></pre></div>
<p>Having created our elements, we print them into our document:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">output_chart</a></code></pre></div>
<div id="circle" style="width:700px;height:432.632880098888px;" class="vegawidget html-widget"></div>
<script type="application/json" data-for="circle">{"x":{
  "chart_spec": {
    "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
    "width": 300,
    "height": 300,
    "data": {
      "values": {
        "x": 1,
        "y": 0
      },
      "name": "source"
    },
    "mark": "point",
    "encoding": {
      "x": {
        "field": "x",
        "type": "quantitative",
        "scale": {
          "domain": [
            -1,
            1
          ]
        }
      },
      "y": {
        "field": "y",
        "type": "quantitative",
        "scale": {
          "domain": [
            -1,
            1
          ]
        }
      }
    }
  },
  "embed_options": {
    "defaultStyle": true,
    "renderer": "canvas"
  }
},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">input_angle</a></code></pre></div>
<input type="range" name="angle" value="0" min="0" max="360" step="1" style="width: 400px; margin-bottom: 10px;"><div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">output_text</a></code></pre></div>
<div id="text" style="font-family: monospace; margin-bottom: 10px;">Look here for live data</div>
<p>It remains to define the interaction among the elements, using JavaScript:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">// this is a {js} chunk</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">// JS reference to our slider-input</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">var</span> input_angle <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">"[name=angle]"</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">// updates the chart and the text output according to the input value</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw">function</span> <span class="at">on_angle</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"></a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="co">// translate the input value to x-y coordinates in a new dataset</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="kw">var</span> theta <span class="op">=</span> <span class="va">input_angle</span>.<span class="at">value</span> <span class="op">*</span> <span class="va">Math</span>.<span class="at">PI</span> / <span class="dv">180</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="kw">var</span> data_live <span class="op">=</span> <span class="op">{</span><span class="dt">x</span><span class="op">:</span> <span class="va">Math</span>.<span class="at">cos</span>(theta)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="va">Math</span>.<span class="at">sin</span>(theta)<span class="op">};</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">  <span class="co">// changes output-text value to show the coordinates</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">"#text"</span>).<span class="at">innerHTML</span> <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(data_live)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb12-16" data-line-number="16">  <span class="co">// changes Vega chart</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">  <span class="at">getVegaPromise</span>(<span class="st">'#circle'</span>).<span class="at">then</span>(<span class="kw">function</span>(result) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb12-19" data-line-number="19">    <span class="co">// create a changeset</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20">    changeSet <span class="op">=</span> <span class="va">vega</span>.<span class="at">changeset</span>()</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">                    .<span class="at">insert</span>(data_live)    <span class="co">// inserts new data</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22">                    .<span class="at">remove</span>(<span class="va">vega</span>.<span class="at">truthy</span>)<span class="op">;</span> <span class="co">// removes all old data</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb12-24" data-line-number="24">    <span class="co">// implement the changeset    </span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25">    <span class="va">result</span>.<span class="va">view</span>.<span class="at">change</span>(<span class="st">'source'</span><span class="op">,</span> changeSet).<span class="at">run</span>()<span class="op">;</span>  </a>
<a class="sourceLine" id="cb12-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb12-27" data-line-number="27">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="op">}</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">// whenever the input changes, run the updating function</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="va">input_angle</span>.<span class="at">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> on_angle)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">// run the updating function *once* as soon as the document is ready</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="va">HTMLWidgets</span>.<span class="at">addPostRenderHandler</span>(on_angle)<span class="op">;</span></a></code></pre></div>
<script type="text/javascript">
// this is a {js} chunk

// JS reference to our slider-input
var input_angle = document.querySelector("[name=angle]");

// updates the chart and the text output according to the input value
function on_angle() {

  // translate the input value to x-y coordinates in a new dataset
  var theta = input_angle.value * Math.PI / 180;
  var data_live = {x: Math.cos(theta), y: Math.sin(theta)};

  // changes output-text value to show the coordinates
  document.querySelector("#text").innerHTML = JSON.stringify(data_live);
  
  // changes Vega chart
  getVegaPromise('#circle').then(function(result) {
  
    // create a changeset
    changeSet = vega.changeset()
                    .insert(data_live)    // inserts new data
                    .remove(vega.truthy); // removes all old data
    
    // implement the changeset    
    result.view.change('source', changeSet).run();  
    
  });
}

// whenever the input changes, run the updating function
input_angle.addEventListener("input", on_angle);

// run the updating function *once* as soon as the document is ready
HTMLWidgets.addPostRenderHandler(on_angle);
</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#demo-streaming-data">Demo: streaming data</a></li>
      <li><a href="#demo-externally-driven-data">Demo: externally-driven data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ian Lyttle, Vega/Vega-Lite Developers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
